<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>ラッキー傭兵団 マッチリソースシミュレーター</title>
<style>
:root {
  --bg:#0b0c10; --fg:#e6ebf5; --card:#151821;
  --border:#2a3144; --muted:#9aa3b2; --accent:#7cc2ff;
}
body {
  margin:0; background:linear-gradient(160deg,#0b0c10,#0f1117); color:var(--fg);
  font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
  overflow-x:hidden; overscroll-behavior-x:none; touch-action:pan-y;
}
.wrap { max-width:1100px; margin:0 auto; padding:20px; }
.card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px; }
header h1 { font-size:26px; display:inline-block; margin:0; }
header span { font-size:16px; color:var(--muted); margin-left:8px; }
.controls { display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end; }
label { display:flex; flex-direction:column; font-size:13px; color:var(--muted); min-width:160px; }
select { padding:6px 10px; border-radius:8px; background:#1a1d26; color:var(--fg); border:1px solid #333; }
button { background:#1f2937; color:var(--fg); border:1px solid #3b4252; border-radius:8px; padding:6px 12px; cursor:pointer; }
button:hover { background:#273041; }
.table-wrap { overflow-x:auto; max-width:100%; }
table { width:100%; border-collapse:collapse; font-size:13px; text-align:right; }
th, td { border:1px solid var(--border); padding:6px 8px; vertical-align:middle; }
th { background:#1a1d26; color:var(--muted); position:sticky; top:0; z-index:2; text-align:center; }
th:first-child, td:first-child { position:sticky; left:0; background:#151821; text-align:center; }
tr.border-after-5 td { border-bottom:2px solid var(--accent); }
img.icon { width:20px; height:20px; display:block; margin:auto; }
.note { font-size:12px; color:var(--muted); margin:6px 0; }
</style>
</head>
<body>
  <main class="wrap">
    <header style="text-align:center; margin-bottom:12px;">
      <h1>ラッキー傭兵団<span>マッチリソースシミュレーター</span></h1>
    </header>
    <section class="card">
      <div class="controls">
        <label>難易度（1〜5試合目）
          <select id="diff_front" onchange="loadData()">
            <option>ノーマル</option><option>ハード</option><option>地獄</option><option>神</option><option selected>太初</option>
          </select>
        </label>
        <label>難易度（6〜25試合目）
          <select id="diff_back" onchange="loadData()">
            <option>ノーマル</option><option>ハード</option><option selected>神</option><option>地獄</option><option>太初</option>
          </select>
        </label>
        <label>エネ倍率
          <select id="energy_mult" onchange="loadData()">
            <option value="1">1倍</option><option value="3" selected>3倍</option>
          </select>
        </label>
        <button id="toggleView">折畳表示</button>
        <button id="toggleRound">整数表示</button>
      </div>
    </section>

    <section class="card">
      <div class="note">※獲得した招待状はユニット募集に使用し、そこで得られるリソースを表中のゴールド、神話石、ダイヤに加算した状態です。</div>
      <div class="table-wrap">
        <table id="table">
          <thead>
            <tr>
              <th>試合</th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_01_gold.png"></th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_02_key.png"></th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_03_chur.png"></th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_04_battery.png"></th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_05_petfood.png"></th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_06_Mythstone.png"></th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_07_immotalstone.png"></th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_08_dia.png"></th>
              <th><img class="icon" src="https://menbold.github.io/LD_Field/i_09_Scroll.png"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const { createClient } = supabase;
const supabaseUrl = "https://cxgbloauhimuhdjlvwvh.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4Z2Jsb2F1aGltdWhkamx2d3ZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4NDQ1MDIsImV4cCI6MjA3NjQyMDUwMn0.wnRHKccWAba4wzC1XHqYPdzL0wF5uQOImbLkn4rs6SA";
const client = createClient(supabaseUrl, supabaseKey);
let roundInt = false;

const fmt = v => {
  if (v == null) return "－";
  if (roundInt) return Math.round(v).toLocaleString("ja-JP");
  return Math.abs(v) >= 100 ? Math.round(v).toLocaleString("ja-JP") : (Math.round(v*10)/10).toLocaleString("ja-JP");
};

async function loadData(condensed=false) {
  const df=document.getElementById('diff_front').value;
  const db=document.getElementById('diff_back').value;
  const en=parseInt(document.getElementById('energy_mult').value);
  const tbody=document.querySelector('#table tbody');
  tbody.innerHTML='<tr><td colspan="10">読込中...</td></tr>';
  const { data, error } = await client
    .from('ld_resources')
    .select('*')
    .eq('diff_front', df)
    .eq('diff_back', db)
    .eq('energy_mult', en)
    .order('match', { ascending: true });
  if (error) { tbody.innerHTML=`<tr><td colspan='10' style='color:red'>Error: ${error.message}</td></tr>`; return; }
  if (!data || data.length===0) { tbody.innerHTML='<tr><td colspan="10">該当データなし</td></tr>'; return; }
  let rows="";
  data.forEach(row=>{
    if(!condensed || row.match%5===0){
      const border=(row.match===5)?' class="border-after-5"':'';
      rows+=`<tr${border}><td>${row.match}</td>`+
             `<td>${fmt(row.gold)}</td><td>${fmt(row.key)}</td><td>${fmt(row.churu)}</td>`+
             `<td>${fmt(row.battery)}</td><td>${fmt(row.petfood)}</td>`+
             `<td>${fmt(row.myth)}</td><td>${fmt(row.immortal)}</td>`+
             `<td>${fmt(row.dia)}</td><td>(${fmt(row.invite)})</td></tr>`;
    }
  });
  tbody.innerHTML=rows;
}

document.getElementById('toggleView').addEventListener('click', e=>{
  const cond = e.target.dataset.state!=='condensed';
  loadData(cond);
  e.target.dataset.state = cond?'condensed':'full';
  e.target.textContent = cond?'全表示':'折畳表示';
});

document.getElementById('toggleRound').addEventListener('click', e=>{
  roundInt=!roundInt; loadData(e.target.dataset.state==='condensed');
  e.target.textContent= roundInt? '小数表示':'整数表示';
});

window.addEventListener('DOMContentLoaded',()=>loadData());
</script>
</body>
</html>
