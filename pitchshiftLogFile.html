<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LD Daily Shop — 編集モック (UNDO保持フル版)</title>
<style>
:root{
  --bg:#0f1113;
  --panel:#131417;
  --muted:#7a7f86;
  --accent:#33aaff;
  --cell-size:38px;
  --prod-size:56px;
  --block-gap:6px;
  --grid-gap:6px;
}
html,body{height:100%;margin:0;}
body{
  font-family:"Hiragino Kaku Gothic ProN","Segoe UI",Roboto,sans-serif;
  background:var(--bg);
  color:#fff;
  display:flex;
  justify-content:center;
  padding:18px;
}
.viewport{ width:95%; max-width:420px; }

/* top buttons */
.topbar { display:flex; gap:8px; margin-bottom:10px; }
.btn { flex:1; background: linear-gradient(180deg,#ffce00,#d4a000); border-radius:10px; padding:10px; font-weight:700; color:#111; border:0; box-shadow:0 4px #b38a00; cursor:pointer; transition: transform .08s, box-shadow .08s; }
.btn:active { transform: translateY(3px); box-shadow:0 2px #b38a00; }
.btn.secondary { background: linear-gradient(180deg,#00b4ff,#0072d4); color:#fff; box-shadow:0 4px #005ea8; }

/* blocks */
.blocks { display:grid; grid-template-columns: repeat(3, 1fr); gap: var(--block-gap); margin-bottom:12px; }
.block {
  background:var(--panel);
  padding:8px;
  border-radius:10px;
  position:relative;
  display:grid;
  grid-template-columns: repeat(3, var(--cell-size));
  grid-template-rows: repeat(2, var(--cell-size));
  gap: var(--grid-gap);
  justify-content:center;
}
.block .label { position:absolute; top:6px; left:8px; font-size:12px; color:var(--muted); }

/* cells */
.cell { width:var(--cell-size); height:var(--cell-size); border-radius:6px; background:#222; display:flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden; box-sizing:border-box; transition: box-shadow .08s, outline .08s; }
.cell img{ max-width:100%; max-height:100%; display:block; }
.cell.editing { outline:3px solid var(--accent); outline-offset:-3px; background:#222; }
.undo-cell { background:transparent; cursor:pointer; padding:2px; }
.undo-cell img{ width:100%; height:100%; object-fit:contain; }

/* products */
.products { display:flex; flex-direction:column; gap:10px; margin-bottom:12px; }
.price-frame { border-radius:10px; padding:6px 4px; display:grid; grid-template-columns: repeat(6, 1fr); gap:8px; align-items:center; }
.gold-frame { border:2px solid gold; background: rgba(255,215,0,0.04); }
.dia-frame  { border:2px solid deepskyblue; background: rgba(0,191,255,0.04); }
.prod-item { width:var(--prod-size); height:var(--prod-size); border-radius:8px; background:#1b1d20; display:flex; align-items:center; justify-content:center; cursor:pointer; transition: transform .06s; }
.prod-item:active{ transform:translateY(2px); }
.prod-item img{ width:70%; height:auto; display:block; }
.prod-empty{ background:transparent; cursor:default; }
.cell[data-type="gold"]{ background: rgba(255,235,180,0.8); }
.cell[data-type="dia"]{  background: rgba(200,235,255,0.8); }

/* legend */
.legend{ display:flex; gap:18px; justify-content:center; align-items:center; color:#cfcfcf; font-size:14px; margin-top:6px;}
.legend .box{ width:30px; height:30px; border-radius:6px; display:flex; align-items:center; justify-content:center; border:2px solid; }
.box.gold{ border-color:gold; } .box.dia{ border-color:deepskyblue; }
.box img{ width:72%; height:auto; display:block; }
.hint{ font-size:12px; color:#aaa; text-align:center; margin-top:8px; }

@media (max-width:360px){ :root{ --cell-size:34px; --prod-size:50px; } }
</style>
</head>
<body>
<div class="viewport">
  <div class="topbar">
    <button id="sendBtn" class="btn">SEND</button>
    <button id="resetBtn" class="btn secondary">All Reset</button>
  </div>

  <div class="blocks" id="blocksContainer">
    <!-- Blocks A-F -->
    <script>
      const blockNames = ['A','B','C','D','E','F'];
      blockNames.forEach(b=>{
        document.write(`
          <div class="block" data-block="${b}">
            <div class="label">${b}</div>
            <div class="cell undo-cell" data-pos="1" data-block="${b}" title="UNDO" onclick="undoBlock('${b}')">
              <img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_UNDO.png?raw=true" alt="undo">
            </div>
            <div class="cell" data-pos="2" data-block="${b}" onclick="focusCell(event)"></div>
            <div class="cell" data-pos="3" data-block="${b}" onclick="focusCell(event)"></div>
            <div class="cell" data-pos="4" data-block="${b}" onclick="focusCell(event)"></div>
            <div class="cell" data-pos="5" data-block="${b}" onclick="focusCell(event)"></div>
            <div class="cell" data-pos="6" data-block="${b}" onclick="focusCell(event)"></div>
          </div>
        `);
      });
    </script>
  </div>

  <!-- 下段：Gold / Dia -->
  <div class="products">
    <div class="price-frame gold-frame" id="goldFrame">
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_01_unit.png" data-type="gold" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_01_unit.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_02_free.png" data-type="gold" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_02_free.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_03_artifacts.png" data-type="gold" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_03_artifacts.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_03_scroll_30.png" data-type="gold" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_03_scroll_30.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_04_scroll_100.png" data-type="gold" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_04_scroll_100.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_05_scroll_300.png" data-type="gold" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_05_scroll_300.png" alt=""></div>
    </div>
    <div class="price-frame dia-frame" id="diaFrame">
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_01_unit.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_01_unit.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_02_free.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_02_free.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_03_artifacts.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_03_artifacts.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_03_scroll_30.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_03_scroll_30.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_04_scroll_100.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_04_scroll_100.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_05_scroll_300.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_05_scroll_300.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_06_Mythstone.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_06_Mythstone.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_07_chur.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_07_chur.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_08_pet_draw.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_08_pet_draw.png" alt=""></div>
      <div class="prod-item" data-src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_09_pet_upgrade.png" data-type="dia" onclick="placeProduct(event)"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_09_pet_upgrade.png" alt=""></div>
    </div>
  </div>

  <div class="legend">
    <div style="display:flex;align-items:center;gap:8px">
      <div class="box gold"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_00_type_gold.png" alt="gold"></div>
      <div>… Gold</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <div class="box dia"><img src="https://raw.githubusercontent.com/MenboLD/LD_Field/main/icon_00_type_dia.png" alt="dia"></div>
      <div>… Dia</div>
    </div>
  </div>
  <div class="hint">下段で選択→上段の編集中マスへ配置。UNDOは各ブロック左上。</div>
</div>

<script>
const blocks = ['A','B','C','D','E','F'];
const slots = {};
const history = {};
const nextIndex = {};
let currentBlock = 'A';

/* 初期化 */
blocks.forEach(b=>{
  slots[b] = [null,null,null,null,null,null,null];
  history[b] = [];
  nextIndex[b] = 2;
});

/* 取得補助 */
function cellEl(block,pos){ return document.querySelector(`.cell[data-block="${block}"][data-pos="${pos}"]`); }
function getNextBlock(block){ const i = blocks.indexOf(block); return blocks[(i+1)%blocks.length]; }

function refreshEditingHighlight(block){
  document.querySelectorAll('.cell').forEach(c=>c.classList.remove('editing'));
  const idx = nextIndex[block];
  if(idx>=2 && idx<=6){
    const el = cellEl(block, idx);
    if(el) el.classList.add('editing');
  }
  currentBlock = block;
}

/* セル選択 */
function focusCell(e){
  const el = e.currentTarget;
  const block = el.dataset.block;
  const pos = Number(el.dataset.pos);
  if(pos>=2 && pos<=6) nextIndex[block] = pos;
  refreshEditingHighlight(block);
}

/* 商品配置 */
function placeProduct(e){
  const item = e.currentTarget;
  const src = item.dataset.src;
  const type = item.dataset.type || null;
  const block = currentBlock;
  const idx = nextIndex[block];
  if(!(idx>=2 && idx<=6)) return;

  slots[block][idx] = {src,type};
  history[block].push(idx);

  const target = cellEl(block,idx);
  if(target){
    target.innerHTML = `<img src="${src}" alt="">`;
    if(type) target.setAttribute('data-type',type); else target.removeAttribute('data-type');
  }

  // 次の入力位置
  let ni = idx+1;
  while(ni<=6 && slots[block][ni]) ni++;
  if(ni<=6){ nextIndex[block]=ni; refreshEditingHighlight(block); }
  else { nextIndex[getNextBlock(block)]=2; refreshEditingHighlight(getNextBlock(block)); }
}

/* UNDO */
function undoBlock(block){
  const last = history[block].pop();
  if(!last) return;
  slots[block][last] = null;
  const t = cellEl(block,last);
  if(t){ t.innerHTML=''; t.removeAttribute('data-type'); }
  nextIndex[block] = last;
  refreshEditingHighlight(block);
}

/* リセット */
document.getElementById('resetBtn').addEventListener('click',()=>{
  blocks.forEach(b=>{
    history[b] = [];
    for(let i=2;i<=6;i++){
      slots[b][i] = null;
      const t = cellEl(b,i);
      if(t){ t.innerHTML=''; t.removeAttribute('data-type'); }
    }
    nextIndex[b]=2;
  });
  currentBlock='A';
  refreshEditingHighlight('A');
});

/* SENDアニメ */
document.getElementById('sendBtn').addEventListener('click',()=>{
  const btn=document.getElementById('sendBtn');
  btn.animate([{transform:'scale(1)'},{transform:'scale(0.98)'},{transform:'scale(1)'}],{duration:180});
});

document.addEventListener('DOMContentLoaded',()=>refreshEditingHighlight(currentBlock));
</script>
</body>
</html>
