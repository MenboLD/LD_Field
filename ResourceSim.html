<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LD Resource Calculator — v4（入力設定復活）</title>
  <style>
    :root{--bg:#0b0c10;--card:#151821;--muted:#9aa3b2;--fg:#e6ebf5;--accent:#7cc2ff;--radius:16px}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(160deg,#0b0c10,#0f1117);color:var(--fg);font:14px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{padding:16px;text-align:center}
    header h1{font-size:18px;margin:0;color:#eaf2ff}
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px 64px}
    .grid{display:grid;gap:14px}
    .card{background:var(--card);border:1px solid #222636;border-radius:var(--radius);padding:14px}
    table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px;max-height:400px;overflow-y:auto;display:block}
    th,td{text-align:right;padding:6px 8px;border:1px solid #2a3144}
    th{background:#1a1d26;color:#a8b2c5;position:sticky;top:0;z-index:1}
    td:first-child,th:first-child{text-align:center}
    tr.border-after-5 td{border-bottom:2px solid var(--accent)}
    button{background:#1f2937;color:var(--fg);border:1px solid #3b4252;border-radius:8px;padding:6px 12px;cursor:pointer;font-size:13px}
    button:hover{background:#273041}
    img.icon{width:20px;height:20px;vertical-align:middle}
    label{display:block;font-size:12px;color:var(--muted);margin:6px 0}
    select{width:100%;background:#0f1320;color:var(--fg);border:1px solid #263045;border-radius:10px;padding:8px}
    .switch{display:inline-flex;align-items:center;gap:8px;cursor:pointer;margin-top:8px}
    .switch input{display:none}
    .toggle{width:38px;height:22px;border-radius:999px;background:#2a3144;position:relative;transition:.2s}
    .toggle::after{content:"";position:absolute;inset:3px auto 3px 3px;width:16px;border-radius:999px;background:#c6d1e3;transition:.2s}
    .switch input:checked+.toggle{background:#1f5fff}
    .switch input:checked+.toggle::after{left:19px}
  </style>
</head>
<body>
  <header>
    <h1>LD Resource Calculator — v4（入力設定復活）</h1>
  </header>
  <main class="wrap grid">
    <section class="card">
      <h2>入力設定</h2>
      <div class="row" style="display:flex;gap:10px;align-items:center">
        <div style="flex:1">
          <label>難易度（1〜5試合目）<select id="diff1" onchange="render()"><option>ノーマル</option><option>太初</option><option selected>神</option><option>地獄</option></select></label>
        </div>
        <div style="flex:1">
          <label>難易度（6〜25試合目）<select id="diff2" onchange="render()"><option>ノーマル</option><option>太初</option><option>神</option><option selected>地獄</option></select></label>
        </div>
      </div>
      <label class="switch"><input id="pack" type="checkbox" checked onchange="render()"><span class="toggle"></span><span>3倍パケ</span></label>
    </section>

    <section class="card" style="grid-column:1/-1">
      <h2>全試合結果 <button id="toggleView">折畳表示</button></h2>
      <table id="table"><thead><tr>
        <th>試合</th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_01_gold.png"></th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_02_key.png"></th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_03_chur.png"></th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_04_battery.png"></th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_05_petfood.png"></th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_06_Mythstone.png"></th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_07_immotalstone.png"></th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_08_dia.png"></th>
        <th><img class="icon" src="https://menbold.github.io/LD_Field/i_09_Scroll.png"></th>
      </tr></thead><tbody></tbody></table>
    </section>
  </main>
  <script>
    const ui={diff1:document.getElementById('diff1'),diff2:document.getElementById('diff2'),pack:document.getElementById('pack'),table:document.querySelector('#table tbody'),toggleView:document.getElementById('toggleView')};
    const BOX_RATE={'神':{'ゴールド':2209,'鍵':0.177,'チュール':0.242,'バッテリー':1.63,'ペットフード':7.246,'神話石':1.178,'不滅石':0.604},'地獄':{'ゴールド':2667,'鍵':0.127,'チュール':0.201,'バッテリー':1.231,'ペットフード':5.539,'神話石':0.841,'不滅石':0}};
    const DROP_KEY={'神':0.1485,'地獄':0.1488};
    const DROP_CHURU={'神':0.1215,'地獄':0.0912};
    const INV_RATE={'神話石':0.0188666667,'ダイヤ':0.2382333333,'ゴールド':7.2401333333,'招待状':4.177};
    const COMPLEX=new Map([[1,0.9916111172],[2,1.8642137572],[3,2.5912570743],[4,3.2677055907],[5,3.8937041288],[6,0.2082139998],[7,0.3910414051],[8,0.5427878803],[9,0.6681540119],[10,0.7728467088],[11,0.8595646008],[12,0.9263440137],[13,0.9745526338],[14,1.0092180488],[15,1.0349780007],[16,1.0544917226],[17,1.0693918403],[18,1.080738938],[19,1.0892210861],[20,1.0953515465],[21,1.0995987043],[22,1.1024041749],[23,1.104159391],[24,1.1051921876],[25,1.1057616302]]);
    const RavgFixed=[1.39165,1.39165,1.39165,1.389006363,1.382978869,1.373779011,1.362026154,1.348450981,1.333745562,1.318497788,1.303172251,1.288114963,1.273568822,1.259692522,1.246579108,1.234272419,1.22278076,1.212087825,1.202161112,1.192958232,1.184431505,1.176531219,1.169207858,1.162413565,1.156103042];
    const fmt=v=>v<1e-8?'－':(v>=100?Math.round(v).toLocaleString('ja-JP'):(Math.round(v*10)/10).toLocaleString('ja-JP'));

    function render(showCondensed=false){
      const N=25;const d1=ui.diff1.value,d2=ui.diff2.value,pack=ui.pack.checked;
      const acc={gold:0,key:0,churu:0,batt:0,pet:0,myth:0,undy:0,dia:0,scroll:0};let prevGod=0,prevHell=0;let rows="";
      for(let n=1;n<=N;n++){
        const R=RavgFixed[n-1]||1;const mult=(pack&&n<=5)?3:1;
        const baseGold=5590*mult*R,baseInv=96*mult*R;
        const mythInv=baseInv*INV_RATE['神話石'],diaInv=baseInv*INV_RATE['ダイヤ'],goldInv=baseInv*INV_RATE['ゴールド'],scrollInv=baseInv*INV_RATE['招待状'];
        const godCum=(n<=5)?COMPLEX.get(n):COMPLEX.get(5),hellCum=(n<=5)?0:COMPLEX.get(n);
        const godAdd=Math.max(0,godCum-prevGod),hellAdd=Math.max(0,hellCum-prevHell);prevGod=godCum;prevHell=hellCum;
        const rg=BOX_RATE[d1],rh=BOX_RATE[d2];
        const goldBox=godAdd*rg['ゴールド']+hellAdd*rh['ゴールド'];
        const kBox=godAdd*rg['鍵']+hellAdd*rh['鍵'];const cBox=godAdd*rg['チュール']+hellAdd*rh['チュール'];
        const bBox=godAdd*rg['バッテリー']+hellAdd*rh['バッテリー'];const pBox=godAdd*rg['ペットフード']+hellAdd*rh['ペットフード'];
        const mBox=godAdd*rg['神話石']+hellAdd*rh['神話石'];const uBox=godAdd*rg['不滅石']+hellAdd*rh['不滅石'];
        const dropK=(n<=5)?DROP_KEY[d1]:DROP_KEY[d2];const dropC=(n<=5)?DROP_CHURU[d1]:DROP_CHURU[d2];
        acc.gold+=baseGold+goldInv+goldBox;acc.key+=kBox+dropK;acc.churu+=cBox+dropC;acc.batt+=bBox;acc.pet+=pBox;acc.myth+=mythInv+mBox;acc.undy+=uBox;acc.dia+=diaInv;acc.scroll+=scrollInv;
        if(!showCondensed||n%5===0){
          const border=(n===5)?' class="border-after-5"':'';
          rows+=`<tr${border}><td>${n}</td><td>${fmt(acc.gold)}</td><td>${fmt(acc.key)}</td><td>${fmt(acc.churu)}</td><td>${fmt(acc.batt)}</td><td>${fmt(acc.pet)}</td><td>${fmt(acc.myth)}</td><td>${fmt(acc.undy)}</td><td>${fmt(acc.dia)}</td><td>(${fmt(acc.scroll)})</td></tr>`;
        }
      }
      ui.table.innerHTML=rows;
    }

    ui.toggleView.addEventListener('click',()=>{
      const condensed=ui.toggleView.dataset.state!=='condensed';
      render(condensed);
      ui.toggleView.textContent=condensed?'全表示':'折畳表示';
      ui.toggleView.dataset.state=condensed?'condensed':'full';
    });

    render();
  </script>
</body>
</html>
